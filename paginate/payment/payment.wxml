<navbar parameter="{{ parameter }}" />
<view class="container">
        <view class="store-info">
                <view class="store-name">{{ addr_name ? addr_name : 'æ´—æ¶ä¹è‡ªåŠ©æ´—è½¦' }}</view>
                <view class="store-address">{{ address ? address : (area ? area : 'æ¬¢è¿ä½¿ç”¨æ™ºèƒ½æ´—è½¦æœåŠ¡') }}</view>
                <view class="store-meta">
                        <text class="meta-item">è®¾å¤‡ç¼–å·ï¼š{{ dev_id ? dev_id : '--' }}</text>
                        <text class="meta-item balance">è´¦æˆ·ä½™é¢ï¼šï¿¥{{ money ? money : '0.00' }}</text>
                </view>
        </view>

        <view class="section-card">
                <view class="section-title">è®¡è´¹æ ‡å‡†</view>
                <view class="info-list">
                        <block wx:for="{{ free_map }}" wx:key="index">
                                <view class="info-item">
                                        <text class="label">{{item.rule_name}}</text>
                                        <text class="price">{{ item.unit_price }}å…ƒ/ç§’</text>
                                </view>
                        </block>
                </view>
        </view>

        <view class="section-card">
                <view class="section-title">ä¼˜æƒ åˆ¸é€‰æ‹©</view>
                <view class="coupon-selector">
                        <view class="coupon-header" wx:if="{{ y_list.length !== 0 }}">
                                <text class="iconfont icon-youhuiquan icon"></text>
                                <text>å¯ç”¨ä¼˜æƒ åˆ¸</text>
                        </view>
                        <block wx:if="{{ y_list.length === 0 }}">
                                <view class="no-coupon">æš‚æ— å¯ç”¨ä¼˜æƒ åˆ¸</view>
                        </block>
                        <block wx:else>
                                <picker class="coupon-picker" range="{{couponOptions}}" value="{{couponIndex}}" bindchange="onCouponChange">
                                        <view class="picker-display {{couponIndex > 0 ? 'has-coupon' : 'no-coupon-selected'}}">
                                                {{couponOptions[couponIndex] ? couponOptions[couponIndex] : 'è¯·é€‰æ‹©ä¼˜æƒ åˆ¸'}}
                                        </view>
                                </picker>

                                <view class="coupon-detail" wx:if="{{couponIndex > 0}}">
                                        <view class="detail-item">
                                                <text class="detail-label">ä¼˜æƒ é‡‘é¢ï¼š</text>
                                                <text class="detail-value">{{y_list[couponIndex-1].total_money}}å…ƒ</text>
                                        </view>
                                        <view class="detail-item">
                                                <text class="detail-label">åˆ¸ç±»å‹ï¼š</text>
                                                <text class="detail-value">{{y_list[couponIndex-1].type_name}}</text>
                                        </view>
                                </view>
                        </block>
                </view>
        </view>

        <view class="section-card" wx:if="{{activities.length > 0}}">
                <view class="section-header">
                        <view class="section-title">ä¼˜æƒ å……å€¼æ´»åŠ¨</view>
                        <view class="section-subtitle">å……å€¼äº«é¢å¤–ä¼˜æƒ </view>
                </view>
                <view class="activity-cards">
                        <view wx:for="{{activities}}" wx:key="id" class="activity-card {{selectedActivity && selectedActivity.index === index ? 'active' : ''}}"
                              bindtap="selectActivity" data-index="{{index}}" data-id="{{item.id}}">
                                <view class="activity-tag" wx:if="{{item.type === 'NEWCOMER'}}">æ–°äººä¸“äº«</view>
                                <view class="activity-title">{{item.title}}</view>
                                <view class="amount">
                                        <text class="money">{{item.money}}å…ƒ</text>
                                        <text class="bonus" wx:if="{{item.awards}}">{{item.type === 'DEAL_COMBO' ? 'é€' + item.awards + 'æ¬¡æ´—è½¦' : item.type === 'MONTH_COMBO' ? 'é€' + item.awards + 'å¤©' : 'é€' + item.awards + 'å…ƒ'}}</text>
                                </view>
                                <view class="deadline" wx:if="{{item.expiration_date}}">æˆªæ­¢æ—¥æœŸï¼š{{item.expiration_date}}</view>
                                <view class="deadline" wx:elif="{{item.remaining_days}}">å‰©ä½™{{item.remaining_days}}å¤©</view>
                        </view>
                </view>
        </view>

        <view class="bottom-placeholder"></view>
</view>

<view class="bottom-action">
        <button class="primary-btn start-btn" hover-class="btn-hover" bindtap="y_pay" wx:if="{{ !(timeMoney && timeMoney.price) }}">
                <text class="btn-icon">ğŸš—</text>
                <text>å¯åŠ¨æ´—è½¦</text>
        </button>
        <button class="secondary-btn recharge-btn" hover-class="btn-hover" bindtap="submitRecharge" disabled="{{ !selectedActivity }}">
                <text class="btn-icon">ğŸ’°</text>
                <text>{{ selectedActivity ? 'ç«‹å³å……å€¼' : 'é€‰æ‹©ä¼˜æƒ åå……å€¼' }}</text>
        </button>
</view>
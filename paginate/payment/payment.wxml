<navbar parameter="{{ parameter }}" />
<view class="payment-container">
	<!-- è®¢å•ä¿¡æ¯åŒºåŸŸ -->
	<view class="order-info">
		<view class="info-card">
			<view class="section-title">è®¡è´¹æ ‡å‡†</view>
			<!-- åŠ¨æ€æ¸²æŸ“è®¡è´¹é¡¹ç›® -->
			<view class="info-list">
			<block wx:for="{{ free_map }}"  wx:key="index">
				<view class="info-item">
					<text>{{item.rule_name}}</text>
					<text class="price">{{ item.unit_price }}å…ƒ/ç§’</text>
				</view>
			</block>
			</view>
		</view>

		<!-- ä¼˜æƒ åˆ¸é€‰æ‹©åŒºåŸŸ -->
		<view class="coupon-card">
			<view class="section-title">ä¼˜æƒ åˆ¸é€‰æ‹©</view>
			<view class="coupon-selector">
				<view class="coupon-header" wx:if="{{ y_list.length !== 0 }}">
					<text class="iconfont icon-youhuiquan icon"></text>
					<text>å¯ç”¨ä¼˜æƒ åˆ¸</text>
				</view>
				<block wx:if="{{ y_list.length === 0 }}">
					<view class="no-coupon">æš‚æ— å¯ç”¨ä¼˜æƒ åˆ¸</view>
				</block>
				<block wx:else>
					<picker class="coupon-picker" range="{{couponOptions}}" value="{{couponIndex}}" bindchange="onCouponChange">
						<view class="picker-display {{couponIndex > 0 ? 'has-coupon' : 'no-coupon-selected'}}">
							{{couponOptions[couponIndex]}}
						</view>
					</picker>

					<view class="coupon-detail" wx:if="{{couponIndex > 0}}">
						<view class="detail-item">
							<text class="label">ä¼˜æƒ é‡‘é¢ï¼š</text>
							<text class="value">{{y_list[couponIndex-1].total_money}}å…ƒ</text>
						</view>
						<view class="detail-item">
							<text class="label">åˆ¸ç±»å‹ï¼š</text>
							<text class="value">{{y_list[couponIndex-1].type_name}}</text>
						</view>
					</view>
				</block>
			</view>
		</view>
	</view>

	<!-- å……å€¼æ´»åŠ¨åŒºåŸŸ -->
	<view class="recharge-section" wx:if="{{activities.length > 0}}">
		<view class="section-header">
			<text class="section-title">ä¼˜æƒ å……å€¼æ´»åŠ¨</text>
			<text class="section-subtitle">å……å€¼äº«é¢å¤–ä¼˜æƒ </text>
		</view>

		<view class="activity-cards">
			<view wx:for="{{activities}}" wx:key="id" class="activity-card {{selectedActivity && selectedActivity.index === index ? 'selected' : ''}}"
				  bindtap="selectActivity" data-index="{{index}}" data-id="{{item.id}}">
				<view class="activity-badge">{{item.title}}</view>
				<view class="activity-content">
					<view class="amount">
						<text class="money">{{item.money}}å…ƒ</text>
						<view wx:if="{{item.type === 'DEAL_COMBO'}}">
							<text class="bonus" wx:if="{{item.awards != 0}}">é€{{item.awards}}æ¬¡æ´—è½¦</text>
						</view>
						<view wx:if="{{item.type === 'MONTH_COMBO'}}">
							<text class="bonus" wx:if="{{item.awards != 0}}">é€30å¤©éšå¿ƒæ´—</text>
						</view>
						<view wx:if="{{item.type === 'HOLIDAY' || item.type === 'NEWCOMER'}}">
							<text class="bonus" wx:if="{{item.awards != 0}}">é€{{item.awards}}å…ƒ</text>
						</view>
					</view>
					<view class="validity" wx:if="{{item.remaining_days}}">
						æœ‰æ•ˆæœŸå‰©ä½™: {{item.remaining_days}}å¤©
					</view>
					<view class="deadline" wx:if="{{item.expiration_date}}">
						æˆªæ­¢: {{item.expiration_date}}
					</view>
				</view>
			</view>
		</view>
	</view>

	<!-- å¯åŠ¨æ´—è½¦æŒ‰é’® -->
	<view class="action-buttons">
		<view class="start-wash-btn" bindtap="y_pay" wx:if="{{ !timeMoney.price }}">
			<text class="btn-icon">ğŸš—</text>
			<text>å¯åŠ¨æ´—è½¦</text>
		</view>

		<view class="recharge-btn {{selectedActivity ? '' : 'disabled'}}"
			  bindtap="submitRecharge" wx:if="{{selectedActivity}}">
			<text class="btn-icon">ğŸ’°</text>
			<text>ç«‹å³å……å€¼</text>
		</view>
	</view>
</view>